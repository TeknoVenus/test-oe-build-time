From af7489b62bbed724f75fa12b943b8a77de2ea614 Mon Sep 17 00:00:00 2001
From: Martin Jansa <Martin.Jansa@gmail.com>
Date: Sat, 13 Mar 2021 18:36:16 +0100
Subject: [PATCH] rust-llvm-1.37.0: fix build with gcc-10

Signed-off-by: Martin Jansa <Martin.Jansa@gmail.com>
---
 ...752888c0282bf5504b67484b92d8d069f1b8.patch | 38 +++++++++++++++++++
 recipes-devtools/rust/rust-llvm_1.37.0.bb     |  3 ++
 2 files changed, 41 insertions(+)
 create mode 100644 recipes-devtools/rust/rust-llvm/98b1752888c0282bf5504b67484b92d8d069f1b8.patch

diff --git a/recipes-devtools/rust/rust-llvm/98b1752888c0282bf5504b67484b92d8d069f1b8.patch b/recipes-devtools/rust/rust-llvm/98b1752888c0282bf5504b67484b92d8d069f1b8.patch
new file mode 100644
index 0000000..430205d
--- /dev/null
+++ b/recipes-devtools/rust/rust-llvm/98b1752888c0282bf5504b67484b92d8d069f1b8.patch
@@ -0,0 +1,38 @@
+From 98b1752888c0282bf5504b67484b92d8d069f1b8 Mon Sep 17 00:00:00 2001
+From: Than McIntosh <thanm@google.com>
+Date: Fri, 19 Jul 2019 13:13:54 +0000
+Subject: [PATCH] Merging r366572:
+
+------------------------------------------------------------------------
+r366572 | thanm | 2019-07-19 06:13:54 -0700 (Fri, 19 Jul 2019) | 12 lines
+
+[NFC] include cstdint/string prior to using uint8_t/string
+
+Summary: include proper header prior to use of uint8_t typedef
+and std::string.
+
+Subscribers: llvm-commits
+
+Reviewers: cherry
+
+Tags: #llvm
+
+Differential Revision: https://reviews.llvm.org/D64937
+------------------------------------------------------------------------
+---
+ include/llvm/Demangle/MicrosoftDemangleNodes.h | 2 ++
+ 1 file changed, 2 insertions(+)
+
+diff --git a/include/llvm/Demangle/MicrosoftDemangleNodes.h b/include/llvm/Demangle/MicrosoftDemangleNodes.h
+index da9d9d5bfdc0..3d47471f0ef0 100644
+--- a/include/llvm/Demangle/MicrosoftDemangleNodes.h
++++ b/include/llvm/Demangle/MicrosoftDemangleNodes.h
+@@ -16,6 +16,8 @@
+ #include "llvm/Demangle/DemangleConfig.h"
+ #include "llvm/Demangle/StringView.h"
+ #include <array>
++#include <cstdint>
++#include <string>
+ 
+ namespace llvm {
+ namespace itanium_demangle {
diff --git a/recipes-devtools/rust/rust-llvm_1.37.0.bb b/recipes-devtools/rust/rust-llvm_1.37.0.bb
index 6fce32f..5794634 100644
--- a/recipes-devtools/rust/rust-llvm_1.37.0.bb
+++ b/recipes-devtools/rust/rust-llvm_1.37.0.bb
@@ -14,3 +14,6 @@ do_install_append () {
 	# we don't need any of this stuff to build Rust
 	rm -rf "${D}/usr/lib/cmake"
 }
+
+# Fix build with gcc-10
+SRC_URI += "file://98b1752888c0282bf5504b67484b92d8d069f1b8.patch"
-- 
2.30.2

